name: Feature-CI

on:
  push:
    branches:
      - feature/**
  pull_request:
    branches:
      - feature/**

env:
  CI: true

jobs:

  ##############################
  # ðŸ·ï¸ FETCH & FAST-FAIL STAGE #
  ##############################

  feature-checks:
    runs-on: ubuntu-latest
    timeout-minutes: 10

    steps:
      - name: ðŸš« Skip if WIP (case-insensitive)
        run: |
          if echo "${{ github.event.head_commit.message }}" | grep -i 'wip'; then
            echo "WIP commit detected, skipping..."
            exit 78
          fi

      - name: âœ… Checkout Code
        uses: actions/checkout@v4

      ##############################
      # â™»ï¸ Cache Dependencies
      ##############################
      - name: â™»ï¸ Cache dependencies
        uses: actions/cache@v3
        with:
          path: |
            ~/.npm
            ~/.cache/pip
          key: ${{ runner.os }}-deps-${{ hashFiles('**/package-lock.json', '**/requirements.txt') }}
          restore-keys: |
            ${{ runner.os }}-deps-

      - name: ðŸ§© Static Code Analysis (Linting)
        run: |
          echo "Run linter"
          # npm run lint or flake8 .

      - name: ðŸ›¡ï¸ Dependency & Vulnerability Scanning
        run: |
          echo "Run dependency scan"
          # npm audit or pip-audit

      - name: ðŸ§ª Run Unit Tests (fail-fast)
        run: |
          echo "Run unit tests"
          # npm test -- --bail

      - name: ðŸ§ª Run Mocked Integration Tests (fail-fast)
        run: |
          echo "Run mocked integration tests"
          # pytest tests/integration --mock

      - name: ðŸ“‹ Upload Summary
        if: always()
        run: |
          echo "### ðŸ§ª Feature CI Results" >> $GITHUB_STEP_SUMMARY
          echo "- Static Analysis: âœ…" >> $GITHUB_STEP_SUMMARY
          echo "- Dependencies: âœ…" >> $GITHUB_STEP_SUMMARY
          echo "- Unit Tests: âœ…" >> $GITHUB_STEP_SUMMARY
          echo "- Integration Tests: âœ…" >> $GITHUB_STEP_SUMMARY
